<style>
  .chat-container.open {
    transform: translateX(0);
  }

  .chat-container {
    background: #fff;
    border: 1px solid #ccc;
    border-radius: 0.5rem;
    bottom: 20px;
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    display: flex;
    flex-direction: column;
    height: 450px;
    transform: translateX(100%);
    transition: transform 0.3s ease-in-out;
    width: 320px;
  }

  .chat-button {
    position: fixed;
    right: -50px;
    z-index: 990;
  }
</style>
<% const isEn = typeof lng !== 'undefined' && lng === 'en'; %>

<section class="section" id="footer">
  <div class="footer-container">
    <footer class="site-footer">
      <div class="footer-main">
        <!-- LINKS: Logo -->
        <div class="footer-left">
          <a href="<%= isEn ? '/en' : '/' %>" class="footerLogo">
            <img src="/images/LogoWhite.svg" alt="Komplett Webdesign Logo" loading="lazy" />
          </a>
        </div>

        <!-- RECHTS: Nav-Liste + Newsletter -->
        <div class="footer-right">
          <!-- Link-Liste -->
          <nav class="footer-nav">
            <h3><%= isEn ? 'Legal' : 'Rechtliches' %></h3>
            <a href="/impressum"><%= isEn ? 'Legal notice' : 'Impressum' %></a>
            <a href="/datenschutz"><%= isEn ? 'Privacy policy' : 'Datenschutz' %></a>
            <!-- <a href="/agb">AGB</a> -->
          </nav>
          <nav class="footer-nav">
            <h3><%= isEn ? 'Information' : 'Informationen' %></h3>
            <a href="<%= isEn ? '/en/webdesign-berlin' : '/webdesign-berlin' %>">Webdesign Berlin</a>
            <a href="<%= isEn ? '/en/kontakt' : '/kontakt' %>"><%= isEn ? 'Contact' : 'Kontakt' %></a>
            <a href="/faq">FAQ</a>
            <a href="/about"><%= isEn ? 'About me' : 'Über mich' %></a>
          </nav>

          <!-- Newsletter-Sektion -->
          <div class="newsletter">
            <h4><%= isEn ? 'Subscribe to newsletter' : 'Zum Newsletter anmelden' %></h4>
            <form action="/newsletter/signup" method="POST" class="newsletter-form">
              <input type="email" name="email" id="newsletterEmail" class="form-control" placeholder="<%= isEn ? 'Your email' : 'Deine E-Mail' %>" required />
              <button type="submit" aria-label="Subscribe">
                <!-- Pfeil-Icon -->
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path d="M10 17l5-5-5-5v10z" />
                </svg>
              </button>
            </form>
            <div class="newsletter-consent">
              <label>
                <input type="checkbox" name="consent" required />
                <%= isEn ? 'I want to subscribe to the newsletter and accept the' : 'Ich moechte mich fuer den Newsletter anmelden und akzeptiere die' %>
                <br />
                <a href="/datenschutz"><%= isEn ? 'privacy policy' : 'Datenschutz Richtlinien' %></a>.*
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- Bottom: Copyright & Socials -->
      <div class="footer-bottom">
        <span>© 2025 KomplettWebdesign. All rights reserved.</span>
        <div class="social-links">
          <a href="https://www.linkedin.com/in/komplettwebdesign" target="_blank" rel="noopener">LinkedIn</a>
          <a href="https://instagram.com/komplettwebdesign" target="_blank" rel="noopener">Instagram</a>
          <a href="https://www.facebook.com/profile.php?id=61579580713573" target="_blank" rel="noopener">Facebook</a>
          <a href="https://www.youtube.com/@komplettwebdesign" target="_blank" rel="noopener">YouTube</a>
          <a href="https://www.tiktok.com/@komplett.webdesign" target="_blank" rel="noopener">TikTok</a>
        </div>
        <a class="back-to-top" href="#hero" aria-label="<%= isEn ? 'Back to top' : 'Zurueck nach oben' %>">
          <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path d="M12 5l7 7-1.4 1.4L13 8.8V19h-2V8.8l-4.6 4.6L5 12z" />
          </svg>
        </a>
      </div>
    </footer>
  </div>
  <a class="back-to-top back-to-top--fixed" href="#hero" aria-label="<%= isEn ? 'Back to top' : 'Zurueck nach oben' %>">
    <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
      <path d="M12 5l7 7-1.4 1.4L13 8.8V19h-2V8.8l-4.6 4.6L5 12z" />
    </svg>
  </a>
  <!-- Floating Chat-Button -->
  <button id="chat-toggle" class="btn btn-primary chat-button"><%= isEn ? 'Chat' : 'Chat' %></button>
  <!-- Chat-Container -->
  <div id="chat-container" class="chat-container">
    <div class="chat-header d-flex justify-content-between align-items-center p-2 border-bottom">
      <strong>Chatbot</strong>
      <button id="chat-close" type="button" class="btn-close" aria-label="<%= isEn ? 'Close chatbot' : 'Button zum schliessen des Chatbots' %>"></button>
    </div>
    <div id="chat-window" class="chat-window"></div>
    <form id="chat-form" class="chat-form input-group">
      <input id="chat-input" type="text" class="form-control" placeholder="<%= isEn ? 'Enter question...' : 'Frage eingeben...' %>" required />
      <button class="btn btn-primary"><%= isEn ? 'Send' : 'Senden' %></button>
    </form>
  </div>
</section>
<%- include('cookie-banner') %>

<script src="/assets/js/bootstrap.bundle.min.js" defer></script>

<script src="/js/navToggle.js" defer></script>
<script src="/js/slideOnScroll.js" defer></script>

<script src="/js/chat.js" defer></script>
<script>
  (function() {
    var siteKey = "<%= process.env.RECAPTCHA_SITEKEY || '' %>";
    if (!siteKey) return;
    if (typeof window === 'undefined') return;
    window.SITEKEY = window.SITEKEY || siteKey;

    document.addEventListener('DOMContentLoaded', function() {
      var contactForm = document.getElementById('kontaktForm');
      var scriptRequested = false;

      function normaliseAction(action) {
        if (!action) return '';
        action = action.trim();
        if (!action) return '';
        try {
          if (/^https?:/i.test(action)) {
            return new URL(action, window.location.origin).pathname;
          }
          if (window.location && action.indexOf(window.location.origin) === 0) {
            return action.slice(window.location.origin.length);
          }
        } catch (err) {
          return '';
        }
        return action;
      }

      function shouldHandle(form) {
        if (!form) return false;
        if (form === contactForm) return false; // eigenes Handling in kontakt.ejs

        if (form.dataset && typeof form.dataset.recaptcha === 'string' && form.dataset.recaptcha.toLowerCase() === 'v3') {
          return true;
        }

        var action = normaliseAction(form.getAttribute('action'));
        return action === '/kontakt';
      }

      function ensureRecaptchaScript() {
        if (scriptRequested) return;
        scriptRequested = true;

        if (document.querySelector('script[src^="https://www.google.com/recaptcha/api.js"]')) {
          return;
        }
        var script = document.createElement('script');
        script.src = 'https://www.google.com/recaptcha/api.js?render=' + encodeURIComponent(window.SITEKEY);
        script.async = true;
        script.defer = true;
        document.head.appendChild(script);
      }

      function bindLazyLoader(form) {
        if (!form) return;
        var triggered = false;

        function cleanup() {
          form.removeEventListener('focusin', onInteraction, true);
          form.removeEventListener('pointerdown', onInteraction, true);
          form.removeEventListener('click', onInteraction, true);
        }

        function onInteraction() {
          if (triggered) return;
          triggered = true;
          cleanup();
          ensureRecaptchaScript();
        }

        form.addEventListener('focusin', onInteraction, true);
        form.addEventListener('pointerdown', onInteraction, true);
        form.addEventListener('click', onInteraction, true);

        if (document.activeElement && form.contains(document.activeElement)) {
          onInteraction();
        }
      }

      var forms = Array.prototype.slice.call(document.forms || []).filter(shouldHandle);
      if (!forms.length) return;

      forms.forEach(bindLazyLoader);
    });
  })();
</script>
<script>
  (function() {
    var backToTop = document.querySelector('.back-to-top--fixed');
    if (!backToTop) return;

    function toggleBackToTop() {
      var show = window.scrollY > window.innerHeight;
      backToTop.classList.toggle('is-visible', show);
    }

    window.addEventListener('scroll', toggleBackToTop, {
      passive: true
    });
    window.addEventListener('resize', toggleBackToTop);
    toggleBackToTop();
  })();
</script>
<script src="/js/recaptcha-form.js" defer></script>
<script src="/js/youtube-consent.js?v=<%= encodeURIComponent(assetVersion || '1') %>" defer></script>
